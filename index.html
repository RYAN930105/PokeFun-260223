<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寶可夢戳戳樂：自定義圖鑑版</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --poke-red: #ee1515; --poke-blue: #3c5aa6; --poke-yellow: #ffcb05;
        }
        body {
            font-family: 'Arial', "Microsoft JhengHei", sans-serif;
            background: radial-gradient(circle, #ffffff 0%, #cfd8dc 100%);
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center;
        }
        h1 { color: var(--poke-blue); text-shadow: 2px 2px var(--poke-yellow); margin: 10px 0; }
        .main-container { display: flex; gap: 30px; flex-wrap: wrap; justify-content: center; width: 100%; max-width: 1300px; }
        .grid-container {
            display: grid; grid-template-columns: repeat(4, 95px); grid-gap: 15px;
            background: #5d4037; padding: 20px; border-radius: 15px;
            border: 8px solid #3e2723; box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }
        .hole { width: 95px; height: 95px; background-color: #222; border-radius: 50%; position: relative; cursor: pointer; }
        .paper {
            width: 100%; height: 100%; 
            background: linear-gradient(var(--poke-red) 48%, #333 48%, #333 52%, white 52%);
            border: 3px solid #333; border-radius: 50%; display: flex;
            justify-content: center; align-items: center; position: absolute; z-index: 2;
            transition: all 0.5s cubic-bezier(0.6, -0.28, 0.735, 0.045);
        }
        .paper::after { content: ''; width: 18px; height: 18px; background: white; border: 3px solid #333; border-radius: 50%; }
        .paper span { position: absolute; bottom: 8px; font-size: 10px; background: white; padding: 0 4px; border-radius: 5px; color: #333; border: 1px solid #333; }
        .hole.popped .paper { transform: translateY(-50px) rotate(20deg); opacity: 0; pointer-events: none; }
        .content {
            width: 100%; height: 100%; background: white; border-radius: 50%;
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1;
        }
        .content img { width: 85%; height: 85%; object-fit: contain; }
        .content b { font-size: 8px; color: #333; text-align: center; line-height: 1.1; margin-top: 2px; }
        .pokedex-area { flex: 1; min-width: 400px; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 4px solid var(--poke-blue); }
        .dex-filter { margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 5px; }
        .filter-btn { padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; border-radius: 10px; cursor: pointer; background: #f9f9f9; }
        .filter-btn.active { background: var(--poke-blue); color: white; border-color: var(--poke-blue); }
        .search-input { width: 100%; padding: 8px; border-radius: 10px; border: 1px solid #ccc; margin-bottom: 10px; box-sizing: border-box; }
        .pokedex-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(65px, 1fr)); grid-gap: 8px; max-height: 500px; overflow-y: auto; padding: 5px; }
        .dex-item { position: relative; border: 1px solid #eee; border-radius: 8px; filter: grayscale(1); opacity: 0.2; transition: 0.3s; padding: 2px; }
        .dex-item.unlocked { filter: grayscale(0); opacity: 1; background: #f0f4ff; border-color: #3c5aa6; }
        .dex-item img { width: 100%; display: block; }
        .dex-name { position: absolute; bottom: 0; width: 100%; font-size: 7px; text-align: center; background: rgba(0,0,0,0.6); color: white; display: none; }
        .dex-item:hover .dex-name { display: block; }
        .controls { margin-top: 20px; display: flex; gap: 10px; justify-content: center; }
        button.action-btn { padding: 12px 24px; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; color: white; }
        .refresh { background: #4caf50; } .reset { background: #f44336; }
    </style>
</head>
<body>

    <h1>⚡ POKÉMON 全型態戳戳樂 ⚡</h1>

    <div class="main-container">
        <div class="game-side">
            <div class="grid-container" id="gameBoard"></div>
            <div class="controls">
                <button class="action-btn refresh" onclick="initGame()">更換新的一盒</button>
                <button class="action-btn reset" onclick="resetCollection()">清除紀錄</button>
            </div>
        </div>

        <div class="pokedex-area">
            <h3>圖鑑進度: <span id="countDisplay">0</span> / <span id="totalDisplay">0</span></h3>
            <input type="text" class="search-input" id="searchDex" placeholder="搜尋名稱 (例如: 傑尼龜3)..." oninput="renderPokedex()">
            <div class="dex-filter" id="typeFilters">
                <button class="filter-btn active" onclick="filterType('All', this)">全部</button>
            </div>
            <div class="pokedex-grid" id="pokedexGrid"></div>
        </div>
    </div>

    <script>
        // 設定原始資料與型態數量 (依據使用者要求)
        const SPECIES_CONFIG = [
            { n: "阿爾宙斯", f: 1, r: "T0", t: "一般" }, { n: "烈空坐", f: 2, r: "T0", t: "龍" },
            { n: "帝牙盧卡", f: 2, r: "T0", t: "鋼" }, { n: "帕路奇亞", f: 2, r: "T0", t: "水" },
            { n: "騎拉帝納", f: 2, r: "T0", t: "幽靈" }, { n: "蓋歐卡", f: 2, r: "T0", t: "水" },
            { n: "固拉多", f: 2, r: "T0", t: "地面" }, { n: "超夢", f: 3, r: "T0", t: "超能" },
            { n: "炎帝", f: 1, r: "T1", t: "火" }, { n: "雷公", f: 1, r: "T1", t: "電" },
            { n: "水君", f: 1, r: "T1", t: "水" }, { n: "急凍鳥", f: 2, r: "T1", t: "冰" },
            { n: "閃電鳥", f: 2, r: "T1", t: "電" }, { n: "火焰鳥", f: 2, r: "T1", t: "火" },
            { n: "拉帝亞斯", f: 2, r: "T1", t: "龍" }, { n: "拉帝歐斯", f: 2, r: "T1", t: "龍" },
            { n: "克雷色利亞", f: 1, r: "T1", t: "超能" }, { n: "夢幻", f: 1, r: "T1", t: "超能" },
            { n: "索爾迦雷歐", f: 1, r: "T1", t: "鋼" },
            { n: "幼基拉斯", f: 4, r: "T2", t: "岩石" }, { n: "圓陸鯊", f: 4, r: "T2", t: "龍" },
            { n: "迷你龍", f: 3, r: "T2", t: "龍" }, { n: "鐵啞鈴", f: 4, r: "T2", t: "鋼" },
            { n: "傑尼龜", f: 5, r: "Starter", t: "水" }, { n: "菊草葉", f: 3, r: "Starter", t: "草" },
            { n: "火球鼠", f: 4, r: "Starter", t: "火" }, { n: "小巨鱷", f: 3, r: "Starter", t: "水" },
            { n: "水躍魚", f: 4, r: "Starter", t: "水" }, { n: "火雉雞", f: 4, r: "Starter", t: "火" },
            { n: "草樹龜", f: 3, r: "Starter", t: "草" }, { n: "小火焰猴", f: 3, r: "Starter", t: "火" },
            { n: "波加曼", f: 3, r: "Starter", t: "水" }, { n: "騰騰蛇", f: 3, r: "Starter", t: "草" },
            { n: "暖暖豬", f: 3, r: "Starter", t: "火" }, { n: "水水獺", f: 4, r: "Starter", t: "水" },
            { n: "小火龍", f: 6, r: "Starter", t: "火" }, { n: "妙蛙種子", f: 5, r: "Starter", t: "草" },
            { n: "伊布", f: 2, r: "Eevee", t: "一般" }, { n: "水伊布", f: 1, r: "Eevee", t: "水" },
            { n: "雷伊布", f: 1, r: "Eevee", t: "電" }, { n: "火伊布", f: 1, r: "Eevee", t: "火" },
            { n: "太陽伊布", f: 1, r: "Eevee", t: "超能" }, { n: "葉伊布", f: 1, r: "Eevee", t: "草" },
            { n: "冰伊布", f: 1, r: "Eevee", t: "冰" }, { n: "利歐路", f: 3, r: "Func", t: "格鬥" },
            { n: "小貓怪", f: 3, r: "Func", t: "電" }, { n: "戴魯比", f: 3, r: "Func", t: "惡" },
            { n: "拉普拉斯", f: 2, r: "Func", t: "水" }, { n: "鴨嘴火獸", f: 1, r: "Func", t: "火" },
            { n: "迷唇姊", f: 1, r: "Func", t: "超能" }, { n: "凱羅斯", f: 2, r: "Func", t: "蟲" },
            { n: "花椰猴", f: 2, r: "Func", t: "草" }, { n: "爆香猴", f: 2, r: "Func", t: "火" },
            { n: "皮卡丘", f: 4, r: "Func", t: "電" }, { n: "呆呆獸", f: 6, r: "Func", t: "水" },
            { n: "獨角蟲", f: 4, r: "Basic", t: "蟲" }, { n: "尼多朗", f: 3, r: "Basic", t: "毒" },
            { n: "尼多蘭", f: 3, r: "Basic", t: "毒" }, { n: "走路草", f: 3, r: "Basic", t: "草" },
            { n: "喇叭芽", f: 3, r: "Basic", t: "草" }, { n: "鯉魚王", f: 3, r: "Basic", t: "水" },
            { n: "蓮葉童子", f: 3, r: "Basic", t: "水" }, { n: "帕奇利茲", f: 1, r: "Basic", t: "電" },
            { n: "六尾", f: 4, r: "Basic", t: "火" }, { n: "啵啵", f: 4, r: "Basic", t: "飛行" },
            { n: "蚊香蝌蚪", f: 3, r: "Basic", t: "水" }, { n: "腕力", f: 4, r: "Basic", t: "格鬥" },
            { n: "小拳石", f: 4, r: "Basic", t: "岩石" }, { n: "鬼斯", f: 2, r: "Basic", t: "幽靈" },
            { n: "耿鬼", f: 3, r: "Basic", t: "幽靈" }, { n: "大鉗蟹", f: 3, r: "Basic", t: "水" }
        ];

        // 展開所有型態為獨立獎項，並設置檔名
        const POKEMON_DB = [];
        SPECIES_CONFIG.forEach(s => {
            for(let i=1; i<=s.f; i++) {
                const fileName = `${s.n}${i}.png`; // 改成使用者要求的 檔名+編號.png
                POKEMON_DB.push({
                    fullname: `${s.n}${i}`,
                    r: s.r,
                    t: s.t,
                    imgFile: fileName,
                    uniqueId: `${s.n}_${i}`
                });
            }
        });

        let unlockedIds = JSON.parse(localStorage.getItem('poker_pro_v5')) || [];
        let currentFilter = 'All';
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSfx(type) {
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            if(type === 'pop') {
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            } else if(type === 'rare') {
                osc.type = 'square'; [440, 554, 659, 880].forEach((f, i) => osc.frequency.setValueAtTime(f, audioCtx.currentTime + i*0.1));
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            }
        }

        function getRandomPokemon() {
            const r = Math.random() * 100;
            let sum = 0;
            const categoryWeights = { "T0": 4, "T1": 2, "T2": 10, "Starter": 23, "Eevee": 15, "Func": 23, "Basic": 23 };
            const counts = {};
            POKEMON_DB.forEach(p => counts[p.r] = (counts[p.r] || 0) + 1);

            for (let p of POKEMON_DB) {
                const weight = categoryWeights[p.r] / counts[p.r];
                sum += weight;
                if (r <= sum) return p;
            }
            return POKEMON_DB[0];
        }

        function renderPokedex() {
            const grid = document.getElementById('pokedexGrid');
            const search = document.getElementById('searchDex').value.toLowerCase();
            grid.innerHTML = '';
            const filtered = POKEMON_DB.filter(p => (currentFilter === 'All' || p.t === currentFilter) && p.fullname.includes(search));
            filtered.forEach(p => {
                const isOwned = unlockedIds.includes(p.uniqueId);
                const div = document.createElement('div');
                div.className = `dex-item ${isOwned ? 'unlocked' : ''}`;
                // 使用自定義圖檔路徑
                div.innerHTML = `<img src="${p.imgFile}" alt="${p.fullname}">
                                 <div class="dex-name">${p.fullname}</div>`;
                grid.appendChild(div);
            });
            document.getElementById('countDisplay').innerText = unlockedIds.length;
            document.getElementById('totalDisplay').innerText = POKEMON_DB.length;
        }

        function initGame() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            for(let i=0; i<16; i++) {
                const poke = getRandomPokemon();
                const hole = document.createElement('div');
                hole.className = 'hole';
                hole.innerHTML = `<div class="paper"><span>${i+1}</span></div>
                    <div class="content">
                        <img src="${poke.imgFile}">
                        <b>${poke.fullname}</b>
                    </div>`;
                hole.onclick = function() {
                    if(this.classList.contains('popped')) return;
                    this.classList.add('popped'); playSfx('pop');
                    if(!unlockedIds.includes(poke.uniqueId)) {
                        unlockedIds.push(poke.uniqueId);
                        localStorage.setItem('poker_pro_v5', JSON.stringify(unlockedIds));
                        renderPokedex();
                    }
                    if(poke.r === 'T0' || poke.r === 'T1') {
                        playSfx('rare');
                        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#ffcb05', '#ffffff', '#3c5aa6'] });
                    }
                };
                board.appendChild(hole);
            }
        }

        const types = ['一般','火','水','草','電','冰','格鬥','毒','地面','飛行','超能','蟲','岩石','幽靈','龍','惡','鋼','妖精'];
        types.forEach(t => {
            const btn = document.createElement('button'); btn.className = 'filter-btn'; btn.innerText = t;
            btn.onclick = (e) => {
                currentFilter = t;
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active'); renderPokedex();
            };
            document.getElementById('typeFilters').appendChild(btn);
        });

        function resetCollection() {
            if(confirm("確定重置圖鑑？所有記錄將永久消失！")) { unlockedIds = []; localStorage.removeItem('poker_pro_v5'); renderPokedex(); }
        }

        initGame(); renderPokedex();
    </script>
</body>
</html>